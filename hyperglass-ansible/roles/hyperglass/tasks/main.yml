---
- name: Create app directory
  file:
    path: /opt/hyperglass
    state: directory

- name: Clone hyperglass repository
  git:
    repo: https://github.com/thatmattlove/hyperglass.git
    dest: /opt/hyperglass
    version: main

- name: Create basic hyperglass config
  copy:
    dest: /opt/hyperglass/hyperglass.yaml
    content: |
      debug: true
      listen_address: 0.0.0.0
      listen_port: 8001
      org_name: "Demo Hyperglass"
      site_title: "Looking Glass Demo"

- name: Open firewall port
  firewalld:
    port: 8001/tcp
    permanent: true
    state: enabled
    immediate: true

- name: Start hyperglass via docker compose
  command: docker compose up -d
  args:
    chdir: /opt/hyperglass
